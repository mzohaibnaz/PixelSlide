(function ( $ ) {
 
    $.fn.pixelSlide = function( options ) {
 
        var settings = $.extend({
            // These are the defaults.
            width: 260,
            height: 190,
            items: 3,
            nextBtn: false,
            prevBtn: false,
            pauseBtn: false,
            startBtn: false,
            mode: "horizontal",
            margin: 10,
            speed: 1000,
            auto: false,
            autoSpeed: 2000,
            toggleClass: false
        }, options );
        var itemLength = this.children("span").length;
        var itemMove = 0;
        // hide next button if there is only 1 item
        if(itemLength == 1){
            $(settings.nextBtn).hide();
        }
        // make main div overflow hidden
        this.css("overflow","hidden");
        // add buttons of next and previous if use not defined
        if(settings.prevBtn == false){
            settings.prevBtn = ".prev";
            $("<span class='prev'>Prev</span>").insertBefore(this);
        }
        if(settings.nextBtn == false){
            settings.nextBtn = ".next";
            $("<span class='next'>Next</span>").insertBefore(this);
        }
        // add start/pause button if auto is true
        if(settings.auto == true){
            if(settings.pauseBtn == false){
                settings.pauseBtn = ".pauseBtn";
                $("<span class='pauseBtn'>Pause</span>").insertBefore(this);
            }
            if(settings.startBtn == false){
                settings.startBtn = ".startBtn";
                $("<span class='startBtn'>Start</span>").insertBefore(this);
            }
        }
        // hide or show start button depends on auto start
        if(settings.auto == false){
            if(settings.toggleClass == false){
                $(settings.pauseBtn).hide();
                $(settings.startBtn).show();
            }else{
                $(settings.pauseBtn).addClass(settings.toggleClass);
                $(settings.startBtn).removeClass(settings.toggleClass);
            }
        }else{
            if(settings.toggleClass == false){
                $(settings.pauseBtn).show();
                $(settings.startBtn).hide();
            }else{
                $(settings.pauseBtn).removeClass(settings.toggleClass);
                $(settings.startBtn).addClass(settings.toggleClass);
            }
        }
        // check slider is horizontal or vertical
        if(settings.mode != "vertical"){
            this.html('<div class="pixelSlide-wrap" style="position: relative; width: '+(itemLength * settings.width + 500) +'px; height: '+settings.height+'px;">'+this.html()+'</div>');
        }else{
            this.html('<div class="pixelSlide-wrap" style="position: relative;">'+this.html()+'</div>');
        }
        
        // add active class and get its index
        $(".pixelSlide-wrap > span:first").addClass("active");
        var itemIndex = $(".pixelSlide-wrap > span[class=active]").index();
        
        
        // next button click
        $(settings.nextBtn).click(function(){
           if((itemIndex + settings.items) != itemLength){
               //show previous button
               if(settings.toggleClass == false){
                    $(settings.prevBtn).show();
               }else{
                    $(settings.prevBtn).removeClass(settings.toggleClass);
               }
               itemIndex += settings.items;
               $(".pixelSlide-wrap > span:eq("+(itemIndex - (settings.items))+")").removeClass("active");
               $(".pixelSlide-wrap > span:eq("+itemIndex+")").addClass("active");
               if(settings.mode != "vertical"){
                   itemMove += (settings.width + settings.margin) * settings.items;
                   $(".pixelSlide-wrap").animate({ 
                        left: "-"+itemMove+"px"
                   },settings.speed);
               }else{
                   itemMove += (settings.height + settings.margin) * settings.items;
                   $(".pixelSlide-wrap").animate({ 
                        top: "-"+itemMove+"px"
                   },settings.speed); 
               }
           }
           if((itemLength - itemIndex) <  settings.items){
                if(settings.toggleClass == false){
                    $(this).hide();
                }else{
                    $(this).addClass(settings.toggleClass);
                }
           }
           if((itemIndex + settings.items) == itemLength){
                if(settings.toggleClass == false){
                    $(this).hide();
                }else{
                    $(this).addClass(settings.toggleClass);
                }
           }else{
                if(settings.toggleClass == false){
                    $(settings.prevBtn).show();
                }else{
                    $(settings.prevBtn).removeClass(settings.toggleClass);
                }
           }
           
        });
        
        // prev button click
        if(settings.toggleClass == false){
            $(settings.prevBtn).hide();
        }else{
            $(settings.prevBtn).addClass(settings.toggleClass);
        }
        $(settings.prevBtn).click(function(){
           itemIndex -= settings.items;
           if(itemIndex == 0){
               if(settings.toggleClass == false){
                   $(settings.prevBtn).hide();
               }else{
                   $(settings.prevBtn).addClass(settings.toggleClass);
               }
           } 
           $(".pixelSlide-wrap > span:eq("+(itemIndex + (settings.items))+")").removeClass("active");
           $(".pixelSlide-wrap > span:eq("+itemIndex+")").addClass("active");
           if(settings.mode != "vertical"){
               itemMove -= (settings.width + settings.margin) * settings.items;
               $(".pixelSlide-wrap").animate({ 
                    left: "-"+itemMove+"px"
               },settings.speed);
           }else{
               itemMove -= (settings.height + settings.margin) * settings.items;
               $(".pixelSlide-wrap").animate({ 
                    top: "-"+itemMove+"px"
               },settings.speed);
           }
           
           if((itemIndex - settings.items) == itemLength){
                if(settings.toggleClass == false){
                    $(this).hide();
                }else{
                    $(this).addClass(settings.toggleClass);
                }
           }else{
                if(settings.toggleClass == false){
                    $(settings.nextBtn).show();
                }else{
                    $(settings.nextBtn).removeClass(settings.toggleClass);
                }
           }
           
        });
        
        // run slide auto with interval function
        var direction = "right";
        var autoRunID = false;
        function autoRun(){
               autoRunID = setInterval(function(){
                    if(itemIndex == 0){
                        direction = "right";
                    }else if((itemLength - itemIndex) <  settings.items){
                        direction = "left";
                    }
                    if(direction == "right"){
                        $(settings.nextBtn).click();
                    }else{
                        $(settings.prevBtn).click();
                    }
                },settings.autoSpeed);
        }
        // start slider if auto start is true
        if(settings.auto == true){
            autoRun();
        }
        // pause slider on button start click
        $(settings.pauseBtn).click(function(){
            if(settings.toggleClass == false){
                $(this).hide();
                $(settings.startBtn).show();
            }else{
                $(this).addClass(settings.toggleClass);
                $(settings.startBtn).removeClass(settings.toggleClass);
            }
            clearInterval(autoRunID);
        });
        // start slider on button start click
        $(settings.startBtn).click(function(){
            if(settings.toggleClass == false){
                $(this).hide();
                $(settings.pauseBtn).show();
            }else{
                $(this).addClass(settings.toggleClass);
                $(settings.pauseBtn).removeClass(settings.toggleClass);
            }
            autoRun();
        });
        return this;
    };
 
}( jQuery ));